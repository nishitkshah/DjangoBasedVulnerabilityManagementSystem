import requests
import random
from datetime import datetime

random.seed(datetime.now())

lk = {
    "node_type": ["webserver", "dbserver", "router", "firewall"],
    "node_name_type": ["ipaddress:port", "weburl"],
    "os": ["Win10", "WinXP", "MacOSX", "Linux", "iOS", "Android", "iOS-router"],
    "resource_type": ["webpage", "service", "os"],
    "finding_severity": ["Very High", "High", "Moderate", "Low", "Negligible"],
    "finding_code_type": ["c code", "py", "perl", "shellcode", "shell script"]
}

def get_value(s):
    n = len(lk[s])
    return lk[s][random.randint(0, n-1)]

def get_a_finding():
    return {
                    "finding_details": "rce",
                    "finding_type": "buff-overflow",
                    "finding_severity": get_value("finding_severity"),
                    "finding_score": random.randint(1, 100),
                    "finding_code": "#include",
                    "finding_code_type": get_value("finding_code_type")
                }

def get_a_resource(n):
    return {
            "resource": "form2.html",
            "resource_type": get_value("resource_type"),
            "resource_criticality": random.randint(1, 10),
            "resource_type": "webpage",
            "findings": [get_a_finding() for f in range(n)]
        }

finding_count_list = [1, 1]

data = {
    "node_name": "123.456.789.012:34567",
    "node_type": get_value("node_type"),
    "node_name_type": get_value("node_name_type"),
    "node_system_details": {
        "os": get_value("os")
    },
    "node_resources": [get_a_resource(n) for n in finding_count_list]
}

print("JSON len:", len(str(data)))
r = requests.post('http://127.0.0.1:8002/node/', json=data)
print(r.status_code)
print(r.json())

new_node = {}
new_node["node"] = r.json()["id"]
new_node["server_address"] = "127.0.0.1:8002"
r = requests.post('http://127.0.0.1:8001/node_manager/', json=new_node)
print(r.status_code)
print(r.json())

